import {
    encryptWithPassword,
    decryptWithPassword,
    packEncryptedData,
    parseEncryptedPackage,
} from "./modules/lib.js";

(function () {
    const passwordInput = document.getElementById("password-input");
    const encryptButton = document.getElementById("encrypt-button");
    const decryptButton = document.getElementById("decrypt-button");
    const plainText = document.getElementById("plain-text");
    const cipherText = document.getElementById("cipher-text");
    encryptButton.addEventListener("click", function () {
        const password = passwordInput.value;
        const text = plainText.value;
        cipherText.value = "encrypting...";
        const bytes = new TextEncoder().encode(text);
        encryptWithPassword(password, bytes)
            .then((encryptedData) => {
                cipherText.value = packEncryptedData(encryptedData);
            })
            .catch((e) => {
                console.error(e);
                cipherText.value = "Failed to encrypt: " + e;
            });
    });
    decryptButton.addEventListener("click", function () {
        const password = passwordInput.value;
        const ciphertext = cipherText.value;
        plainText.value = "decrypting...";
        const encryptedData = parseEncryptedPackage(ciphertext);
        decryptWithPassword(password, encryptedData)
            .then((decryptedBuffer) => {
                const decryptedText = new TextDecoder().decode(decryptedBuffer);
                plainText.value = decryptedText;
            })
            .catch((e) => {
                console.error(e);
                plainText.value =
                    "Failed to decrypt: incorrect password or corrupted ciphertext!";
            });
    });
})();
